#!/usr/bin/env bash
set -euo pipefail

NS_PAY=payments
NS_ATT=attacker

PAY_POD=$(kubectl -n "$NS_PAY" get pod -l app=payments-api -o jsonpath='{.items[0].metadata.name}')
ATT_POD=attacker

SVC_IP=$(kubectl -n "$NS_PAY" get svc payments-api -o jsonpath='{.spec.clusterIP}')

echo "[*] payments-api pod: $NS_PAY/$PAY_POD"
echo "[*] attacker pod: $NS_ATT/$ATT_POD"
echo "[*] payments-api Service IP: $SVC_IP"

echo "[*] From attacker namespace, curling payments-api (should succeed because there is no NetworkPolicy):"
kubectl -n "$NS_ATT" exec "$ATT_POD" -- sh -c "wget -qO- http://${SVC_IP}:80 | head -n 5"

