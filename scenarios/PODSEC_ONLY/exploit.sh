#!/usr/bin/env bash
set -euo pipefail

NS=podsec-only
POD=$(kubectl -n "$NS" get pod -l app=insecure-web -o jsonpath='{.items[0].metadata.name}')

echo "[*] Pod securityContext:"
kubectl -n "$NS" get pod "$POD" -o jsonpath='{.spec.containers[0].securityContext}' | jq .

echo
echo "[*] Sample can-i checks for web-sa (should be fairly tight):"
kubectl auth can-i list pods --as=system:serviceaccount:$NS:web-sa --namespace "$NS"
kubectl auth can-i delete pods --as=system:serviceaccount:$NS:web-sa --namespace "$NS" || true

