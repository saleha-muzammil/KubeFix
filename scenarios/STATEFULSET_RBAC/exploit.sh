#!/usr/bin/env bash
set -euo pipefail

NS=stateful-rbac
POD=$(kubectl -n "$NS" get pod -l app=redis -o jsonpath='{.items[0].metadata.name}')

echo "[*] StatefulSet pod status:"
kubectl -n "$NS" get pod "$POD" -o wide

echo "[*] Over-permissive Role redis-overperm:"
kubectl -n "$NS" get role redis-overperm -o yaml

echo "[*] Sample can-i checks under redis-sa:"
kubectl auth can-i list secrets --as=system:serviceaccount:$NS:redis-sa --namespace "$NS"
kubectl auth can-i delete configmaps --as=system:serviceaccount:$NS:redis-sa --namespace "$NS"

